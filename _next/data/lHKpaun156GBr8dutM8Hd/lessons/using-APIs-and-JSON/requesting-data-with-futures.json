{"pageProps":{"post":{"attributes":{},"html":"<p>Dart doesn&#39;t map automatically JSON values into classes, so we have to do it manually. We will add some factory methods in <code>DataModel.dart</code> for our Product and Category classes as:</p>\n<h2 id=\"data-model-to-the-rescue\">Data Model to the rescue</h2>\n<pre><code class=\"hljs language-dart\">\n  <span class=\"hljs-comment\">// Add this in class Product</span>\n  <span class=\"hljs-keyword\">factory</span> Product.fromJson(<span class=\"hljs-built_in\">Map</span>&lt;<span class=\"hljs-built_in\">String</span>, <span class=\"hljs-built_in\">dynamic</span>&gt; json) {\n    <span class=\"hljs-keyword\">return</span> Product(\n        id: json[<span class=\"hljs-string\">&#x27;id&#x27;</span>] <span class=\"hljs-keyword\">as</span> <span class=\"hljs-built_in\">int</span>,\n        name: json[<span class=\"hljs-string\">&#x27;name&#x27;</span>] <span class=\"hljs-keyword\">as</span> <span class=\"hljs-built_in\">String</span>,\n        price: json[<span class=\"hljs-string\">&#x27;price&#x27;</span>] <span class=\"hljs-keyword\">as</span> <span class=\"hljs-built_in\">double</span>,\n        image: json[<span class=\"hljs-string\">&#x27;image&#x27;</span>] <span class=\"hljs-keyword\">as</span> <span class=\"hljs-built_in\">String</span>);\n  }\n\n  <span class=\"hljs-comment\">// Add this in class Category</span>\n  <span class=\"hljs-keyword\">factory</span> Category.fromJson(<span class=\"hljs-built_in\">Map</span>&lt;<span class=\"hljs-built_in\">String</span>, <span class=\"hljs-built_in\">dynamic</span>&gt; json) {\n    <span class=\"hljs-keyword\">var</span> productsJson = json[<span class=\"hljs-string\">&#x27;products&#x27;</span>] <span class=\"hljs-keyword\">as</span> <span class=\"hljs-built_in\">Iterable</span>&lt;<span class=\"hljs-built_in\">dynamic</span>&gt;;\n    <span class=\"hljs-keyword\">var</span> products = productsJson.map((p) =&gt; Product.fromJson(p)).toList();\n    <span class=\"hljs-keyword\">return</span> Category(name: json[<span class=\"hljs-string\">&#x27;name&#x27;</span>] <span class=\"hljs-keyword\">as</span> <span class=\"hljs-built_in\">String</span>, products: products);\n  }\n\n  \n</code></pre>\n<h2 id=\"using-futures-to-get-the-network-response-and-parse-json\">Using Futures to get the network response and parse JSON</h2>\n<p>In DataManager.dart add the following methods</p>\n<pre><code class=\"hljs language-dart\">fetchMenu() <span class=\"hljs-keyword\">async</span> {\n    <span class=\"hljs-keyword\">try</span> {\n      <span class=\"hljs-keyword\">const</span> url = <span class=\"hljs-string\">&#x27;https://firtman.github.io/coffeemasters/api/menu.json&#x27;</span>;\n      <span class=\"hljs-keyword\">var</span> response = <span class=\"hljs-keyword\">await</span> http.<span class=\"hljs-keyword\">get</span>(<span class=\"hljs-built_in\">Uri</span>.parse(url));\n\n      <span class=\"hljs-keyword\">if</span> (response.statusCode == <span class=\"hljs-number\">200</span>) {\n        _menu = [];\n        <span class=\"hljs-keyword\">var</span> decodedData = jsonDecode(response.body) <span class=\"hljs-keyword\">as</span> <span class=\"hljs-built_in\">List</span>&lt;<span class=\"hljs-built_in\">dynamic</span>&gt;;\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">var</span> json <span class=\"hljs-keyword\">in</span> decodedData) {\n          _menu?.add(Category.fromJson(json));\n        }\n      } <span class=\"hljs-keyword\">else</span> {\n        <span class=\"hljs-keyword\">throw</span> Exception(<span class=\"hljs-string\">&quot;Error loading data&quot;</span>);\n      }\n    } <span class=\"hljs-keyword\">catch</span> (e) {\n      <span class=\"hljs-keyword\">throw</span> Exception(<span class=\"hljs-string\">&quot;Error loading data&quot;</span>);\n    }\n  }\n\n    Future&lt;<span class=\"hljs-built_in\">List</span>&lt;Category&gt;&gt; getMenu() <span class=\"hljs-keyword\">async</span> {\n    <span class=\"hljs-keyword\">if</span> (_menu == <span class=\"hljs-keyword\">null</span>) {\n      <span class=\"hljs-keyword\">await</span> fetchMenu();\n    }\n    <span class=\"hljs-keyword\">return</span> _menu!;\n  }\n</code></pre>\n","slug":"requesting-data-with-futures","title":"Requesting Data with Futures","section":"Using APIs and JSON","icon":"bridge","filePath":"/home/runner/work/intro-flutter/intro-flutter/lessons/06-using-APIs-and-JSON/B-requesting-data-with-futures.md","nextSlug":"/intro-flutter/lessons/using-APIs-and-JSON/finishing-the-menu","prevSlug":"/intro-flutter/lessons/using-APIs-and-JSON/adding-dependencies"}},"__N_SSG":true}